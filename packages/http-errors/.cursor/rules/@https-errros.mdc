---
description: Conventions, layout and templates for the central HTTP errors package
globs: 
alwaysApply: false
---

- **Package Purpose**
  - Single source-of-truth for all shared HTTP errors across backend services.
  - Guarantees error consistency and standardization across the monorepo.
  - Enables shared CustomError handling between client projects and other packages.
  - Public API surface is only `packages/http-errors/src/index.ts`.

- **Structure**
  - Place all error definitions in `packages/http-errors/src/index.ts`.
  - **Single file approach**: All HTTP errors are defined in one centralized index file.
  - Export both the `CustomError` class and all error constant definitions.
  - Import and use `HttpStatus` from `@nestjs/common` for status codes.

- **Core Components**
  - **CustomError Class**
    - The package provides a `CustomError` class that extends NestJS's `HttpException`:
      ```typescript
      export class CustomError extends HttpException {
        constructor({ description, status }: ICustomError) {
          super(description, status);
        }

        static fromError(error: Error, status?: HttpStatus): CustomError {
          return new CustomError({
            status: status || HttpStatus.INTERNAL_SERVER_ERROR,
            description: error.message,
          });
        }
      }
      ```
  - **ICustomError Interface**
    - All error constants must follow the `ICustomError` interface:
      ```typescript
      export interface ICustomError {
        status: HttpStatus;
        description: string;
      }
      ```

- **Naming Conventions**
  - Error constant identifiers → UPPER_SNAKE_CASE
    - `USER_NOT_FOUND`, `INVALID_CREDENTIALS`, `UNAUTHORIZED_ACCESS`
  - Error descriptions → Clear, human-readable messages in Title Case
    - `"User Not Found"`, `"Invalid Credentials"`, `"Unauthorized Access"`
  - Use descriptive names that clearly indicate the error condition
  - **Examples of Good Naming**:
    ```typescript
    // ✅ Correct naming patterns
    export const USER_NOT_FOUND: ICustomError = {
      status: HttpStatus.NOT_FOUND,
      description: "User Not Found",
    };

    export const INVALID_CREDENTIALS: ICustomError = {
      status: HttpStatus.UNAUTHORIZED,
      description: "Invalid Credentials",
    };

    export const INSUFFICIENT_PERMISSIONS: ICustomError = {
      status: HttpStatus.FORBIDDEN,
      description: "Insufficient Permissions",
    };

    // ❌ Wrong naming patterns
    export const userNotFound: ICustomError = { ... };           // Wrong: not UPPER_SNAKE_CASE
    export const USER_ERROR: ICustomError = { ... };             // Wrong: too generic
    export const NOTFOUND: ICustomError = { ... };               // Wrong: not descriptive enough
    ```

- **Error Categories and HTTP Status Codes**
  - **4xx Client Errors**
    ```typescript
    // Authentication & Authorization (401, 403)
    export const INVALID_CREDENTIALS: ICustomError = {
      status: HttpStatus.UNAUTHORIZED,
      description: "Invalid Credentials",
    };

    export const UNAUTHORIZED_ACCESS: ICustomError = {
      status: HttpStatus.UNAUTHORIZED,
      description: "Unauthorized Access",
    };

    export const INSUFFICIENT_PERMISSIONS: ICustomError = {
      status: HttpStatus.FORBIDDEN,
      description: "Insufficient Permissions",
    };

    // Not Found (404)
    export const USER_NOT_FOUND: ICustomError = {
      status: HttpStatus.NOT_FOUND,
      description: "User Not Found",
    };

    export const RESOURCE_NOT_FOUND: ICustomError = {
      status: HttpStatus.NOT_FOUND,
      description: "Resource Not Found",
    };

    // Bad Request (400)
    export const INVALID_REQUEST_DATA: ICustomError = {
      status: HttpStatus.BAD_REQUEST,
      description: "Invalid Request Data",
    };

    export const MISSING_REQUIRED_FIELDS: ICustomError = {
      status: HttpStatus.BAD_REQUEST,
      description: "Missing Required Fields",
    };

    // Conflict (409)
    export const USER_ALREADY_EXISTS: ICustomError = {
      status: HttpStatus.CONFLICT,
      description: "User Already Exists",
    };
    ```
  - **5xx Server Errors**
    ```typescript
    // Internal Server Error (500)
    export const INTERNAL_SERVER_ERROR: ICustomError = {
      status: HttpStatus.INTERNAL_SERVER_ERROR,
      description: "Internal Server Error",
    };

    export const DATABASE_CONNECTION_ERROR: ICustomError = {
      status: HttpStatus.INTERNAL_SERVER_ERROR,
      description: "Database Connection Error",
    };

    // Service Unavailable (503)
    export const SERVICE_UNAVAILABLE: ICustomError = {
      status: HttpStatus.SERVICE_UNAVAILABLE,
      description: "Service Temporarily Unavailable",
    };
    ```

- **Usage Pattern**
  - When using CustomError in your application code:
    ```typescript
    import { CustomError, USER_NOT_FOUND, INVALID_CREDENTIALS } from '@packages/http-errors';

    // Basic usage
    if (!user) {
      throw new CustomError(USER_NOT_FOUND);
    }

    // Multiple conditions
    if (!user) {
      throw new CustomError(USER_NOT_FOUND);
    } else if (!isValidPassword) {
      throw new CustomError(INVALID_CREDENTIALS);
    }

    // Using the fromError static method
    try {
      await someOperation();
    } catch (error) {
      throw CustomError.fromError(error, HttpStatus.BAD_REQUEST);
    }
    ```

- **Definition Checklist**
  - Use `HttpStatus` enum from `@nestjs/common` for all status codes.
  - Follow the `ICustomError` interface structure.
  - Use UPPER_SNAKE_CASE for error constant names.
  - Provide clear, descriptive error messages.
  - Choose appropriate HTTP status codes based on the error type.
  - Add JSDoc comments for complex or domain-specific errors.

- **Boilerplate Template**
  ```typescript
  /**
   * [Brief description of when this error occurs]
   */
  export const ERROR_NAME: ICustomError = {
    status: HttpStatus.APPROPRIATE_STATUS_CODE,
    description: "Clear Error Description",
  };
  ```

- **Complete Index File Structure**
  ```typescript
  import { HttpException, HttpStatus } from "@nestjs/common";

  export interface ICustomError {
    status: HttpStatus;
    description: string;
  }

  export class CustomError extends HttpException {
    constructor({ description, status }: ICustomError) {
      super(description, status);
    }

    static fromError(error: Error, status?: HttpStatus): CustomError {
      return new CustomError({
        status: status || HttpStatus.INTERNAL_SERVER_ERROR,
        description: error.message,
      });
    }
  }

  // ============================================================================
  // 4xx CLIENT ERRORS
  // ============================================================================

  // Authentication & Authorization
  export const INVALID_CREDENTIALS: ICustomError = {
    status: HttpStatus.UNAUTHORIZED,
    description: "Invalid Credentials",
  };

  export const UNAUTHORIZED_ACCESS: ICustomError = {
    status: HttpStatus.UNAUTHORIZED,
    description: "Unauthorized Access",
  };

  // Not Found
  export const USER_NOT_FOUND: ICustomError = {
    status: HttpStatus.NOT_FOUND,
    description: "User Not Found",
  };

  // Add more error constants as needed...

  // ============================================================================
  // 5xx SERVER ERRORS
  // ============================================================================

  export const INTERNAL_SERVER_ERROR: ICustomError = {
    status: HttpStatus.INTERNAL_SERVER_ERROR,
    description: "Internal Server Error",
  };

  // Add more server error constants as needed...
  ```

- **Common Error Patterns**
  - **Entity Not Found Pattern**
    ```typescript
    export const USER_NOT_FOUND: ICustomError = {
      status: HttpStatus.NOT_FOUND,
      description: "User Not Found",
    };

    export const ORDER_NOT_FOUND: ICustomError = {
      status: HttpStatus.NOT_FOUND,
      description: "Order Not Found",
    };

    export const PRODUCT_NOT_FOUND: ICustomError = {
      status: HttpStatus.NOT_FOUND,
      description: "Product Not Found",
    };
    ```
  - **Validation Error Pattern**
    ```typescript
    export const INVALID_EMAIL_FORMAT: ICustomError = {
      status: HttpStatus.BAD_REQUEST,
      description: "Invalid Email Format",
    };

    export const PASSWORD_TOO_WEAK: ICustomError = {
      status: HttpStatus.BAD_REQUEST,
      description: "Password Does Not Meet Requirements",
    };
    ```
  - **Business Logic Error Pattern**
    ```typescript
    export const INSUFFICIENT_BALANCE: ICustomError = {
      status: HttpStatus.BAD_REQUEST,
      description: "Insufficient Account Balance",
    };

    export const ORDER_ALREADY_COMPLETED: ICustomError = {
      status: HttpStatus.CONFLICT,
      description: "Order Already Completed",
    };
    ```

- **Assistant reminders (when this rule is active)**
  - All HTTP errors must be defined in the single `src/index.ts` file.
  - Always use UPPER_SNAKE_CASE for error constant names.
  - Include appropriate HTTP status codes using `HttpStatus` enum.
  - Provide clear, descriptive error messages for better debugging.
  - Group related errors with comments for better organization.
  - When adding new errors, consider if they fit existing patterns or establish new ones.
  - Remember that these errors are shared across the entire monorepo - name them descriptively. 